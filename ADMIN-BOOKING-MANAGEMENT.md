# ระบบจัดการการจองทัวร์สำหรับแอดมิน

## ฟีเจอร์ที่รองรับ

### 1. **หน้ารายการการจอง (/admin/bookings)**
- แสดงการจองทั้งหมดจัดกลุ่มตามแพ็คเกจ
- ตัวกรองตามแพ็คเกจ, สถานะการจอง, สถานะการชำระเงิน
- อัพเดทสถานะการจองและชำระเงินแบบ inline
- ดูรายละเอียดการจองแต่ละรายการ

### 2. **หน้ารายละเอียดการจอง (/admin/bookings/:id)**
- แสดงรายละเอียดการจองครบถ้วน
- อัพเดทสถานะการจองและชำระเงิน
- เพิ่มหมายเหตุ
- ดูสลิปโอนเงิน
- ลิงก์ไปหน้ารายละเอียดสำหรับลูกค้า

### 3. **การจัดการสถานะ**
- **สถานะการจอง**: pending, confirmed, cancelled, completed
- **สถานะการชำระเงิน**: pending, paid, failed, refunded
- อัพเดทแบบ real-time

## ไฟล์ที่สร้าง/แก้ไข

### **Frontend Pages**
- `src/app/admin/bookings/page.tsx` ✅ (สร้างใหม่)
- `src/app/admin/bookings/[id]/page.tsx` ✅ (สร้างใหม่)

### **API Endpoints**
- `src/app/api/admin/bookings/[id]/route.ts` ✅ (แก้ไข)

## วิธีการใช้งาน

### **สำหรับแอดมิน**

#### 1. **เข้าถึงหน้ารายการการจอง**
- URL: `/admin/bookings`
- แสดงการจองทั้งหมดจัดกลุ่มตามแพ็คเกจ

#### 2. **กรองข้อมูล**
- เลือกแพ็คเกจที่ต้องการดู
- กรองตามสถานะการจอง
- กรองตามสถานะการชำระเงิน
- คลิก "กรองข้อมูล"

#### 3. **อัพเดทสถานะแบบ inline**
- เลือกสถานะใหม่จาก dropdown
- ระบบจะอัพเดททันที
- แสดง loading state ขณะอัพเดท

#### 4. **ดูรายละเอียดการจอง**
- คลิก "ดูรายละเอียด" ในตาราง
- ไปที่หน้า `/admin/bookings/:id`

#### 5. **จัดการรายละเอียดการจอง**
- อัพเดทสถานะการจอง
- อัพเดทสถานะการชำระเงิน
- เพิ่มหมายเหตุ
- ดูสลิปโอนเงิน
- ลิงก์ไปหน้ารายละเอียดสำหรับลูกค้า

## UI Components

### **หน้ารายการการจอง**
```
┌─────────────────────────────────────┐
│ Header: จัดการการจองทัวร์           │
├─────────────────────────────────────┤
│ Filters: แพ็คเกจ, สถานะ, ชำระเงิน   │
├─────────────────────────────────────┤
│ Package Groups:                     │
│ ┌─────────────────────────────────┐ │
│ │ Package Header (Green)          │ │
│ │ - Package Info                  │ │
│ │ - Booking Count                 │ │
│ ├─────────────────────────────────┤ │
│ │ Bookings Table                  │ │
│ │ - Customer Info                 │ │
│ │ - Tour Date                     │ │
│ │ - Participants                  │ │
│ │ - Total Price                   │ │
│ │ - Status Dropdowns              │ │
│ │ - Actions                       │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### **หน้ารายละเอียดการจอง**
```
┌─────────────────────────────────────┐
│ Breadcrumb Navigation               │
├─────────────────────────────────────┤
│ Main Content (2/3 width)            │
│ - Booking Status                    │
│ - Package Info                      │
│ - Tour Details                      │
│ - Contact Info                      │
├─────────────────────────────────────┤
│ Management Sidebar (1/3 width)      │
│ - Status Management                 │
│ - Payment Slip                      │
│ - Quick Actions                     │
└─────────────────────────────────────┘
```

## API Endpoints

### **GET /api/admin/bookings**
- ดึงข้อมูลการจองทั้งหมด
- รองรับการกรองตาม status และ paymentStatus
- Populate package และ user data

### **GET /api/admin/bookings/[id]**
- ดึงข้อมูลการจองรายละเอียด
- Populate package และ user data

### **PUT /api/admin/bookings/[id]**
- อัพเดทสถานะการจอง
- อัพเดทสถานะการชำระเงิน
- เพิ่มหมายเหตุ
- รองรับการอัพเดทเฉพาะฟิลด์ที่ต้องการ

### **DELETE /api/admin/bookings/[id]**
- ยกเลิกการจอง
- คืนจำนวนที่ว่างให้แพ็คเกจ

## การทดสอบ

### 1. **รันเซิร์ฟเวอร์**
```bash
npm run dev
```

### 2. **ทดสอบหน้ารายการการจอง**
- ไปที่ `/admin/bookings`
- ตรวจสอบว่าหน้าโหลดได้
- ทดสอบการกรองข้อมูล
- ทดสอบการอัพเดทสถานะ

### 3. **ทดสอบหน้ารายละเอียดการจอง**
- คลิก "ดูรายละเอียด" ในตาราง
- ตรวจสอบว่าหน้าโหลดได้
- ทดสอบการอัพเดทข้อมูล

### 4. **ทดสอบ API โดยตรง**
```bash
# ดึงข้อมูลการจองทั้งหมด
curl -X GET http://localhost:3000/api/admin/bookings

# ดึงข้อมูลการจองรายละเอียด
curl -X GET http://localhost:3000/api/admin/bookings/BOOKING_ID

# อัพเดทสถานะการจอง
curl -X PUT http://localhost:3000/api/admin/bookings/BOOKING_ID \
  -H "Content-Type: application/json" \
  -d '{"status": "confirmed", "paymentStatus": "paid"}'
```

## การแก้ไขปัญหา

### **ปัญหา: Cannot read properties of undefined (reading 'id')**
- **สาเหตุ**: API ไม่ได้รับ params.id อย่างถูกต้อง
- **การแก้ไข**: เพิ่ม debug logging และตรวจสอบ params
- **ไฟล์ที่แก้ไข**: `src/app/api/admin/bookings/[id]/route.ts`

### **ปัญหา: การอัพเดทสถานะไม่สำเร็จ**
- **สาเหตุ**: API ไม่รองรับการอัพเดทเฉพาะฟิลด์
- **การแก้ไข**: แก้ไข PUT endpoint ให้รองรับการอัพเดทเฉพาะฟิลด์ที่ต้องการ
- **ไฟล์ที่แก้ไข**: `src/app/api/admin/bookings/[id]/route.ts`

## หมายเหตุ
- ระบบต้องมีการ authentication สำหรับแอดมิน
- รองรับการอัพเดทสถานะแบบ real-time
- มีการจัดกลุ่มการจองตามแพ็คเกจ
- รองรับการกรองข้อมูลแบบหลากหลาย
- มีการแสดง loading state และ error handling
